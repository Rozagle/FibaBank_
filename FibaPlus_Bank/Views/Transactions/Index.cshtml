@model List<FibaPlus_Bank.Models.Transaction>
@{
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}
<link href="~/css/transactions.css" rel="stylesheet" asp-append-version="true" />

<div class="container-fluid">

    <div class="row mb-4">
        <div class="col-12">
            <a href="/Accounts/Index" class="btn-back">
                <i class="fa-solid fa-arrow-left"></i> Hesaplarıma Dön
            </a>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-7">

            <div class="custom-card border-0 shadow-sm" style="border-radius: 24px; padding: 40px;">

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold m-0 text-dark">Son İşlemler</h4>
                    <span class="badge bg-light text-primary px-3 py-2 rounded-pill border border-primary border-opacity-10">Tümü</span>
                </div>

                @if (Model == null || Model.Count == 0)
                {
                    <div class="d-flex flex-column align-items-center justify-content-center py-5">
                        <div class="bg-light rounded-circle d-inline-flex p-4 mb-3">
                            <i class="fa-solid fa-receipt fa-3x text-secondary opacity-25"></i>
                        </div>
                        <h6 class="fw-bold text-muted">Henüz işlem bulunamadı</h6>
                        <p class="text-muted small">İşlem geçmişiniz burada listelenecektir.</p>
                    </div>
                }
                else
                {
                    <div class="trans-list">
                        @foreach (var item in Model)
                        {
                            bool isIncoming = (item.TransactionType == "İade" || item.TransactionType == "Gelen Transfer" || item.TransactionStatus == "Refunded");

                            string flowClass = isIncoming ? "bg-success bg-opacity-10 text-success" : "bg-danger bg-opacity-10 text-danger"; 
                            string textClass = isIncoming ? "amount-pos" : "amount-neg";
                            string prefix = isIncoming ? "+" : "-";

                            string currency = item.Account != null ? item.Account.CurrencyCode : "TRY";
                            string logoClass = item.CategoryIcon ?? "fa-solid fa-money-bill-transfer";
                            string date = item.TransactionDate.HasValue ? item.TransactionDate.Value.ToString("dd.MM.yyyy") : "-";

                            string title = item.ReceiverName;
                            if (item.TransactionType == "İade") { title = "İADE İŞLEMİ"; logoClass = "fa-solid fa-rotate-left"; }

                            <div class="trans-item">
                                <div class="trans-icon-box @flowClass me-3">
                                    <i class="@logoClass"></i>
                                </div>

                                <div class="flex-grow-1">
                                    <div class="fw-bold text-dark mb-1">@title</div>
                                    <div class="text-muted small">
                                        <span class="text-secondary">@item.TransactionType</span>
                                        <span class="mx-1">•</span>
                                        <span>@date</span>
                                    </div>
                                </div>

                                <div class="text-end">
                                    <div class="@textClass mb-2">
                                        @prefix @item.Amount.GetValueOrDefault().ToString("N2") @currency
                                    </div>
                                    <button class="btn-receipt" onclick="downloadReceipt('@item.ReferenceCode')">
                                        <i class="fa-solid fa-file-invoice me-1"></i> Dekont
                                    </button>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>

        </div>
    </div>
</div>
<script src="~/js/transactions.js" asp-append-version="true"></script>
